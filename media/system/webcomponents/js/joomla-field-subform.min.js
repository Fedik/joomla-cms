!function(t){"use strict";t.define("joomla-field-subform",class extends HTMLElement{get buttonAdd(){return this.getAttribute("button-add")}get buttonRemove(){return this.getAttribute("button-remove")}get buttonMove(){return this.getAttribute("button-move")}get rowsContainer(){return this.getAttribute("rows-container")}get repeatableElement(){return this.getAttribute("repeatable-element")}get minimum(){return this.getAttribute("minimum")}get maximum(){return this.getAttribute("maximum")}connectedCallback(){let t=this;if(this.containerWithRows=this,this.rowsContainer){let t=this.querySelectorAll(this.rowsContainer);for(let i=0,r=t.length;i<r;i++)if(e(t[i],"joomla-field-subform")===this){this.containerWithRows=t[i];break}}this.lastRowNum=this.getRows().length,this.template="",this.prepareTemplate(),this.addEventListener("click",function(i){let r=e(i.target,t.buttonAdd),o=e(i.target,t.buttonRemove);if(r&&e(r,"joomla-field-subform")===t){let i=e(r,t.repeatableElement);this.addRow(i)}else if(o&&e(o,"joomla-field-subform")===t){let i=e(o,t.repeatableElement);this.removeRow(i)}}),this.buttonMove&&new Sortable.default(this.containerWithRows,{draggable:this.repeatableElement,handle:this.buttonMove})}getRows(){let t=this.containerWithRows.children,e=document.body.msMatchesSelector?"msMatchesSelector":"matches",i=[];for(let r=0,o=t.length;r<o;r++)t[r][e](this.repeatableElement)&&i.push(t[r]);return i}prepareTemplate(){let t=[].slice.call(this.children).filter(function(t){return t.classList.contains("subform-repeatable-template-section")});if(t[0]&&(this.template=t[0].innerHTML),!this.template)throw new Error("The row template are required to subform element to work")}addRow(t){const e=this.getRows().length;if(e>=this.maximum)return null;let i;(i="TBODY"===this.containerWithRows.nodeName||"TABLE"===this.containerWithRows.nodeName?document.createElement("tbody"):document.createElement("div")).innerHTML=this.template;let r=i.children[0];return t?t.parentNode.insertBefore(r,t.nextSibling):this.containerWithRows.append(r),r.setAttribute("data-new","1"),this.fixUniqueAttributes(r,e),this.dispatchEvent(new CustomEvent("subform-row-add",{detail:{row:r},bubbles:!0})),window.Joomla&&Joomla.Event.dispatch(r,"joomla:updated"),r}removeRow(t){const e=this.getRows().length;e<=this.minimum||(this.dispatchEvent(new CustomEvent("subform-row-remove",{detail:{row:t},bubbles:!0})),window.Joomla&&Joomla.Event.dispatch(t,"joomla:removed"),t.parentNode.removeChild(t))}fixUniqueAttributes(t,i){this.lastRowNum++,i=i||0;let r=t.getAttribute("data-group"),o=t.getAttribute("data-base-name"),n=Math.max(this.lastRowNum,i+1),l=o+n;this.lastRowNum=n,t.setAttribute("data-group",l);let s=t.querySelectorAll("[name]"),a={};for(let i=0,o=s.length;i<o;i++){let o=s[i],n=o.getAttribute("name"),u=n.replace(/(\[\]$)/g,"").replace(/(\]\[)/g,"__").replace(/\[/g,"_").replace(/\]/g,""),m=n.replace("["+r+"][","["+l+"]["),h=u.replace(r,l),b=0,d=u;if("checkbox"===o.type&&n.match(/\[\]$/)){if(!(b=a[u]?a[u].length:0)){let i=e(o,"fieldset.checkboxes"),r=t.querySelector('label[for="'+u+'"]');i&&i.setAttribute("id",h),r&&(r.setAttribute("for",h),r.setAttribute("id",h+"-lbl"))}d+=b,h+=b}else if("radio"===o.type){if(!(b=a[u]?a[u].length:0)){let i=e(o,"fieldset.radio"),r=t.querySelector('label[for="'+u+'"]');i&&i.setAttribute("id",h),r&&(r.setAttribute("for",h),r.setAttribute("id",h+"-lbl"))}d+=b,h+=b}a[u]?a[u].push(!0):a[u]=[!0],o.setAttribute("name",m),o.setAttribute("id",h);let c=t.querySelector('label[for="'+d+'"]');c&&(c.setAttribute("for",h),c.setAttribute("id",h+"-lbl"))}}});function e(t,e){let i;["matches","msMatchesSelector"].some(function(t){return"function"==typeof document.body[t]&&(i=t,!0)});let r;for(;t;){if((r=t.parentElement)&&r[i](e))return r;t=r}return null}}(customElements);